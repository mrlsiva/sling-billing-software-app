<div class="cart-panel" [class.open]="open" [class.pulse]="pulse" role="dialog" aria-label="Cart">
    <header class="cart-header">
        <strong>Cart</strong>
        <div class="cart-controls">
            <button (click)="clear()" title="Clear cart" aria-label="Clear cart"><i
                    class="fa-solid fa-trash-can"></i></button>
            <button (click)="close()" title="Close" aria-label="Close cart"><i
                    class="fa-solid fa-chevron-down"></i></button>
        </div>
    </header>

    <div *ngIf="pulse" class="cart-added">Added</div>

    <div class="cart-body">
        <ul class="cart-items" *ngIf="items?.length; else emptyCart">
            <li class="cart-item" *ngFor="let it of items">
                <div class="ci-main">
                    <div class="d-flex flex-row align-center space-between">
                        <div class="ci-title">{{ it.product.product?.name || it.product.name }}</div>
                        <div class="quantity-info">
                            Qty: {{ it.qty }}<span *ngIf="getAvailableQuantity(it) > 0">/{{ getAvailableQuantity(it)
                                }}</span>
                            <span *ngIf="getAvailableQuantity(it) === 0" class="no-stock">(No stock info)</span>
                        </div>
                    </div>
                    <div class="ci-categories space-between d-flex align-center">
                        <div class="d-flex flex-row">
                            <div class="category">{{ it.product.product?.category?.name || it.product.category?.name }}
                            </div>
                            <div class="subcategory">{{ it.product.product?.sub_category?.name ||
                                it.product.sub_category?.name }}</div>

                        </div>

                    </div>
                </div>



                <div class="ci-pricing d-flex flex-row align-center space-between">
                    <div class="price-info d-flex align-center">
                        <!-- Match POS structure: it.product.price -->
                        <div class="base-price">{{ it.product?.price | currency:'INR':'symbol':'1.2-2' }}</div>
                        <!-- Match POS structure: it.product.tax_amount -->
                        <div class="tax-amount">Tax: {{ (it.product?.tax_amount || 0) |
                            currency:'INR':'symbol':'1.2-2' }}
                            <span *ngIf="taxPercent(it) !== null"> ({{ taxPercent(it) }}%)</span>
                        </div>
                    </div>
                    <div class="ci-actions d-flex flex-row">
                        <button (click)="inc(it.id)" [disabled]="it.qty >= getAvailableQuantity(it)"
                            [class.disabled-btn]="it.qty >= getAvailableQuantity(it)"
                            [title]="it.qty >= getAvailableQuantity(it) ? 'Maximum quantity reached' : 'Increase quantity'"
                            aria-label="Increase">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                        <button (click)="dec(it.id)" aria-label="Decrease"><i class="fa-solid fa-minus"></i></button>
                        <button (click)="del(it.id)" aria-label="Remove"><i class="fa-solid fa-trash"></i></button>
                    </div>

                </div>
            </li>
        </ul>

        <ng-template #emptyCart>
            <div class="empty">Cart is empty</div>
        </ng-template>
    </div>

    <footer class="cart-footer">
        <div class="cart-summary">Total: Rs. {{ cart.totalPrice() }} â€” Items: {{ cart.totalItems() }}</div>
        <button class="checkout" title="Checkout" (click)="goToCheckout()">Checkout</button>
    </footer>
</div>

<button *ngIf="cart.totalItems() > 0" class="cart-toggle" (click)="toggle()" aria-label="Open cart">
    <i class="fa-solid fa-cart-shopping"></i>
    <span class="badge">{{ cart.totalItems() }}</span>
</button>

<!-- <div class="cart-toast" *ngIf="toast">{{ toast }}</div> -->