<div class="page page-order">
    <!-- Order List View -->
    <div *ngIf="!showOrderDetail">
        <!-- Search Section -->
        <div class="search-container">
            <div class="search-input-wrapper">
                <div class="search-input-group">
                    <svg class="input-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" class="search-input" placeholder="Search orders by Bill ID, customer ID..."
                        [(ngModel)]="searchTerm" (input)="onSearch()" autocomplete="off">
                    <button *ngIf="searchTerm" class="clear-search-btn" (click)="clearSearch()" type="button"
                        aria-label="Clear search">
                        <i class="clear-icon">‚úï</i>
                    </button>
                </div>
            </div>
            <div *ngIf="searchTerm" class="search-results-info">
                <div class="results-summary">
                    <span class="results-text">Showing {{orders.length}} of {{totalItems}} orders (Page
                        {{currentPage}} of {{totalPages}})</span>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h2 class="page-title">Orders</h2>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
            <div class="loading-spinner">Loading orders...</div>
        </div>

        <!-- Error State -->
        <div *ngIf="error && !loading" class="error-container">
            <div class="error-message">
                <span class="error-icon">‚ö†Ô∏è</span>
                {{ error }}
            </div>
        </div>

        <!-- Orders List -->
        <div *ngIf="!loading && !error" class="orders-container">

            <!-- Empty State -->
            <div *ngIf="orders.length === 0" class="empty-state">
                <div class="empty-icon">üìÑ</div>
                <h3>No orders found</h3>
                <p>{{ searchTerm ? 'Try adjusting your search criteria.' : 'No orders have been placed yet.' }}</p>
            </div>

            <!-- Orders Grid -->
            <div *ngIf="orders.length > 0" class="orders-grid">
                <div *ngFor="let order of orders" class="order-card" (click)="viewOrderDetail(order)">
                    <div class="order-header">
                        <div class="order-id">
                            <strong>{{ order.bill_id }}</strong>
                        </div>
                        <div class="order-status" [ngClass]="getOrderStatusClass(order.is_refunded)">
                            {{ getOrderStatus(order.is_refunded) }}
                        </div>
                    </div>

                    <div class="order-info">
                        <div class="order-amount">
                            <span class="amount-label">Total:</span>
                            <span class="amount-value">{{ formatCurrency(order.bill_amount) }}</span>
                        </div>

                        <div class="order-date">
                            <span class="date-label">Date:</span>
                            <span class="date-value">{{ formatDate(order.billed_on) }}</span>
                        </div>

                        <div class="order-customer">
                            <span class="customer-label">Customer ID:</span>
                            <span class="customer-value">#{{ order.customer_id }}</span>
                        </div>
                    </div>

                    <div class="order-footer">
                        <button class="view-details-btn">
                            View Details ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pagination Component -->
            <div *ngIf="totalPages > 1" class="pagination-container">
                <div class="pagination-info">
                    <span class="pagination-text">
                        Showing {{ ((currentPage - 1) * itemsPerPage) + 1 }} to {{ Math.min(currentPage *
                        itemsPerPage,
                        totalItems) }} of {{ totalItems }} orders
                    </span>
                </div>
                <div class="pagination-controls">
                    <!-- First Page Button -->
                    <button (click)="goToFirstPage()" [disabled]="currentPage === 1" class="pagination-btn"
                        title="First Page">
                        ‚ü™
                    </button>

                    <!-- Previous Page Button -->
                    <button (click)="goToPreviousPage()" [disabled]="currentPage === 1" class="pagination-btn"
                        title="Previous Page">
                        ‚ü®
                    </button>

                    <!-- Page Numbers -->
                    <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)"
                        [class.active]="page === currentPage" class="pagination-btn page-number">
                        {{ page }}
                    </button>

                    <!-- Next Page Button -->
                    <button (click)="goToNextPage()" [disabled]="currentPage === totalPages" class="pagination-btn"
                        title="Next Page">
                        ‚ü©
                    </button>

                    <!-- Last Page Button -->
                    <button (click)="goToLastPage()" [disabled]="currentPage === totalPages" class="pagination-btn"
                        title="Last Page">
                        ‚ü´
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Detail View -->
    <div *ngIf="showOrderDetail" class="order-detail-page">
        <div class="order-detail-nav">
            <button class="nav-icon" aria-label="Back" (click)="goBack()">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h2>Order Details</h2>
        </div>

        <div *ngIf="loadingOrderDetail" class="loading-detail">
            <div class="loading-spinner">Loading order details...</div>
        </div>

        <div *ngIf="!loadingOrderDetail && selectedOrder" class="order-detail-content">
            <!-- Order Summary -->
            <div class="order-summary">
                <h4>Order Summary</h4>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="label">Bill ID:</span>
                        <span class="value">{{ selectedOrder.bill_id }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Total Amount:</span>
                        <span class="value amount">{{ formatCurrency(selectedOrder.bill_amount) }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Date:</span>
                        <span class="value">{{ formatDate(selectedOrder.billed_on) }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Status:</span>
                        <span class="value" [ngClass]="getOrderStatusClass(selectedOrder.is_refunded)">
                            {{ getOrderStatus(selectedOrder.is_refunded) }}
                        </span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Customer ID:</span>
                        <span class="value">#{{ selectedOrder.customer_id }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Billed By:</span>
                        <span class="value">User #{{ selectedOrder.billed_by }}</span>
                    </div>
                </div>
            </div>

            <!-- Order Items -->
            <div class="order-items">
                <h4>Order Items</h4>
                <div class="items-table">
                    <div class="table-header">
                        <div class="col-item">Item</div>
                        <div class="col-qty">Qty</div>
                        <div class="col-price">Price</div>
                        <div class="col-tax">Tax</div>
                        <div class="col-total">Total</div>
                    </div>
                    <div *ngFor="let item of orderDetails" class="table-row">
                        <div class="col-item">
                            <div class="item-name">{{ item.name }}</div>
                            <!-- <div class="item-id">Product #{{ item.product_id }}</div> -->
                        </div>
                        <div class="col-qty">{{ item.quantity }}</div>
                        <div class="col-price">{{ formatCurrency(item.selling_price) }}</div>
                        <div class="col-tax">
                            <div class="d-flex align-item-center gap-8">{{ formatCurrency(item.tax_amount) }}
                                <small>({{ item.tax_percent }}%)</small>
                            </div>
                        </div>
                        <div class="col-total">
                            {{ formatCurrency(parseFloat(item.selling_price) * parseFloat(item.quantity)) }}
                        </div>
                    </div>
                </div>

                <!-- Order Totals -->
                <div class="order-totals">
                    <div class="total-row">
                        <span class="total-label">Subtotal:</span>
                        <span class="total-value">{{ formatCurrency(calculateOrderTotal()) }}</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label">Total Tax:</span>
                        <span class="total-value">{{ formatCurrency(calculateTotalTax()) }}</span>

                    </div>
                    <div class="total-row final-total">
                        <span class="total-label">Final Total:</span>
                        <span class="total-value">{{ formatCurrency(selectedOrder.bill_amount) }}</span>
                    </div>
                </div>
            </div>

            <!-- Payment Details -->
            <div class="payment-details" *ngIf="orderPaymentDetails.length > 0">
                <h4>Payment Details</h4>
                <div *ngFor="let payment of orderPaymentDetails" class="payment-item">
                    <div class="payment-info">
                        <span class="payment-label">Payment Method:</span>
                        <span class="payment-value">Method #{{ payment.payment_id }}</span>
                    </div>
                    <div class="payment-info">
                        <span class="payment-label">Amount:</span>
                        <span class="payment-value">{{ formatCurrency(payment.amount) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>