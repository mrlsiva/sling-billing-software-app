<div class="categories-container">
    <div class="header-section">
        <button class="back-btn" (click)="goBack()" aria-label="Go back">
            <i class="fa-solid fa-arrow-left"></i> Back
        </button>
        <h1>Categories</h1>
        <div class="header-actions">
            <button class="refresh-btn" (click)="refreshCategories()" aria-label="Refresh categories">
                <i class="fa-solid fa-arrows-rotate"></i>
            </button>
            <button class="create-btn" (click)="openCreateModal()" aria-label="Create category">
                <i class="fa-solid fa-plus"></i> Create Category
            </button>
        </div>
    </div>

    <div class="error-message" *ngIf="error && !showModal">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span>{{ error }}</span>
    </div>

    <div class="loading-spinner" *ngIf="loading && !showModal">
        <i class="fa-solid fa-spinner fa-spin"></i>
        <p>Loading categories...</p>
    </div>

    <div class="categories-list" *ngIf="!loading && categories.length > 0">
        <div class="category-item" *ngFor="let category of categories">
            <div class="category-image-small">
                <img [src]="getImageUrl(category.image)" [alt]="category.name"
                    onerror="this.src='https://test.slingbillings.com/no-image-icon.jpg'" />
            </div>
            <div class="category-details">
                <h3 class="category-name">{{ category.name }}</h3>
                <div class="category-meta">
                    <span class="subcategory-count">
                        <i class="fa-solid fa-list"></i>
                        {{ category.sub_categories.length }} subcategories
                    </span>
                    <div class="subcategories" *ngIf="category.sub_categories.length > 0">
                        <span *ngFor="let sub of category.sub_categories" class="subcategory-tag">
                            {{ sub.name }}
                        </span>
                    </div>
                </div>
            </div>
            <div class="category-actions">
                <button class="edit-btn-icon" (click)="openEditModal(category)" aria-label="Edit category">
                    <i class="fa-solid fa-pen"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="no-data" *ngIf="!loading && categories.length === 0">
        <i class="fa-solid fa-folder-open"></i>
        <p>No categories found</p>
        <button class="create-btn" (click)="openCreateModal()">
            <i class="fa-solid fa-plus"></i> Create Your First Category
        </button>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="!loading && totalPages > 1">
        <div class="pagination-info">
            Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalItems }} categories
        </div>
        <div class="pagination-controls">
            <button (click)="goToFirstPage()" [disabled]="currentPage === 1" aria-label="First page">
                <i class="fa-solid fa-angles-left"></i>
            </button>
            <button (click)="previousPage()" [disabled]="currentPage === 1" aria-label="Previous page">
                <i class="fa-solid fa-angle-left"></i>
            </button>

            <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)" [class.active]="page === currentPage"
                [attr.aria-label]="'Page ' + page">
                {{ page }}
            </button>

            <button (click)="nextPage()" [disabled]="currentPage === totalPages" aria-label="Next page">
                <i class="fa-solid fa-angle-right"></i>
            </button>
            <button (click)="goToLastPage()" [disabled]="currentPage === totalPages" aria-label="Last page">
                <i class="fa-solid fa-angles-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>{{ modalTitle }}</h2>
            <button class="close-btn" (click)="closeModal()" aria-label="Close modal">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div class="modal-body">
            <div class="error-message" *ngIf="error">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span>{{ error }}</span>
            </div>

            <form (ngSubmit)="submitForm()">
                <div class="form-group">
                    <label for="categoryName">Category Name <span class="required">*</span></label>
                    <input type="text" id="categoryName" [(ngModel)]="categoryName" name="categoryName"
                        placeholder="Enter category name" required />
                </div>

                <div class="form-group">
                    <label for="categoryImage">Category Image (Optional)</label>
                    <div class="image-upload-section">
                        <div class="image-preview" *ngIf="imagePreview">
                            <img [src]="imagePreview" alt="Category preview" />
                            <button type="button" class="remove-image-btn" (click)="removeImage()">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                        <input type="file" id="categoryImage" (change)="onImageSelect($event)" accept="image/*" />
                        <label for="categoryImage" class="file-label">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            {{ selectedImage ? 'Change Image' : 'Upload Image' }}
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" (click)="closeModal()">
                        Cancel
                    </button>
                    <button type="submit" class="submit-btn" [disabled]="loading">
                        <i class="fa-solid fa-spinner fa-spin" *ngIf="loading"></i>
                        <i class="fa-solid fa-check" *ngIf="!loading"></i>
                        {{ loading ? 'Saving...' : (isEditMode ? 'Update' : 'Create') }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>