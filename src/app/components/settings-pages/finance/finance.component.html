<div class="page-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-left">
            <h2 class="page-title">Finance Management</h2>
            <p class="page-subtitle">Manage your finance options</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" (click)="openCreateModal()">
                <i class="fa-solid fa-plus"></i>
                Add Finance
            </button>
            <button class="btn btn-secondary" (click)="goBack()">
                <i class="fa-solid fa-arrow-left"></i>
                Back
            </button>
        </div>
    </div>

    <!-- Search and Controls -->
    <div class="page-controls">
        <div class="search-container">
            <div class="search-input-wrapper">
                <i class="fa-solid fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search finances..." [(ngModel)]="searchTerm"
                    (input)="onSearchChange()">
                <button *ngIf="searchTerm" class="clear-search" (click)="clearSearch()" aria-label="Clear search">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
        </div>
        <div class="controls-right">
            <button class="btn btn-outline refresh-btn" (click)="refreshFinances()" [disabled]="loading">
                <i class="fa-solid fa-refresh" [class.spinning]="loading"></i>
                Refresh
            </button>
        </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
        <i class="fa-solid fa-exclamation-triangle"></i>
        {{ error }}
        <button class="btn btn-sm btn-outline" (click)="error = null; refreshFinances()">
            Try Again
        </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading && !finances.length" class="loading-container">
        <div class="loading-spinner">
            <i class="fa-solid fa-spinner spinning"></i>
        </div>
        <p>Loading finances...</p>
    </div>

    <!-- Finances Table -->
    <div *ngIf="!loading || finances.length" class="table-container">
        <div *ngIf="filteredFinances.length === 0 && !loading" class="empty-state">
            <div class="empty-icon">
                <i class="fa-solid fa-credit-card"></i>
            </div>
            <h3>No finances found</h3>
            <p *ngIf="searchTerm">No finances match your search criteria. Try adjusting your search.</p>
            <p *ngIf="!searchTerm">Get started by adding your first finance option.</p>
            <button *ngIf="!searchTerm" class="btn btn-primary" (click)="openCreateModal()">
                <i class="fa-solid fa-plus"></i>
                Add Finance
            </button>
        </div>

        <table *ngIf="filteredFinances.length > 0" class="data-table">
            <thead>
                <tr>
                    <th>Finance Name</th>
                    <th>Status</th>
                    <th>Created Date</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let finance of filteredFinances; trackBy: trackByFinanceId">
                    <td>
                        <div class="finance-name">
                            <strong>{{ finance.name }}</strong>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge" [ngClass]="getStatusClass(finance.is_active)">
                            {{ getStatusText(finance.is_active) }}
                        </span>
                    </td>
                    <td>{{ formatDate(finance.created_at) }}</td>
                    <td>{{ formatDate(finance.updated_at) }}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline" (click)="openEditModal(finance)"
                                title="Edit finance">
                                <i class="fa-solid fa-edit"></i>
                            </button>
                            <button class="btn btn-sm"
                                [ngClass]="finance.is_active === 1 ? 'btn-warning' : 'btn-success'"
                                (click)="toggleFinanceStatus(finance.id, finance.is_active)"
                                [title]="finance.is_active === 1 ? 'Deactivate finance' : 'Activate finance'">
                                <i class="fa-solid"
                                    [ngClass]="finance.is_active === 1 ? 'fa-toggle-on' : 'fa-toggle-off'"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination-container">
        <div class="pagination-info">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
            {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} entries
        </div>
        <div class="pagination">
            <button class="btn btn-sm btn-outline" [disabled]="currentPage === 1"
                (click)="loadFinances(currentPage - 1)">
                <i class="fa-solid fa-chevron-left"></i>
                Previous
            </button>

            <span class="page-numbers">
                <button *ngFor="let page of [].constructor(totalPages); let i = index" class="btn btn-sm"
                    [ngClass]="currentPage === i + 1 ? 'btn-primary' : 'btn-outline'" (click)="loadFinances(i + 1)"
                    [disabled]="currentPage === i + 1">
                    {{ i + 1 }}
                </button>
            </span>

            <button class="btn btn-sm btn-outline" [disabled]="currentPage === totalPages"
                (click)="loadFinances(currentPage + 1)">
                Next
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">{{ modalTitle }}</h3>
            <button class="modal-close" (click)="closeModal()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>

        <form (ngSubmit)="submitForm()" #financeForm="ngForm">
            <div class="modal-body">
                <div *ngIf="error" class="error-message">
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    {{ error }}
                </div>

                <div class="form-group">
                    <label for="financeName" class="form-label">Finance Name *</label>
                    <input type="text" id="financeName" name="financeName" class="form-input"
                        placeholder="Enter finance name (e.g., Bank Transfer, Credit Line)" [(ngModel)]="financeName"
                        required #financeNameInput="ngModel"
                        [class.error]="financeNameInput.invalid && financeNameInput.touched">
                    <div *ngIf="financeNameInput.invalid && financeNameInput.touched" class="field-error">
                        Finance name is required
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeModal()">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="financeForm.invalid || loading">
                    <i *ngIf="loading" class="fa-solid fa-spinner spinning"></i>
                    {{ isEditMode ? 'Update' : 'Create' }} Finance
                </button>
            </div>
        </form>
    </div>
</div>